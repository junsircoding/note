# Git源代码管理

## 1.基础操作

- ### 工作区暂存区和仓库区

- #### 工作区

- 对于`添加`、`修改`、`删除`文件的操作，都发生在工作区中

- #### 暂存区

- 暂存区指将工作区中的操作完成小阶段的存储，是版本库的一部分

- #### 仓库区

- 仓库区表示个人开发的一个小阶段的完成
  - 仓库区中记录的各版本是可以查看并回退的
  - 但是在暂存区的版本一旦提交就再也没有了

### **1.查看git安装结果**

```bash
  git
  # 查看git版本
  git --version
```

### **2.创建本地仓库**

- 进入到项目目录，并创建本地仓库,创建好后项目目录会出现`.git`的隐藏文件,表示git仓库创建完毕

```bash
  # 创建本地仓库
  git init
```

### **3.配置个人信息**

```bash
  # 设置默认账户
  git config user.name '张三'
  # 设置默认邮箱
  git config user.email 'zhangsan@163.com'
```

**4.查看文件状态**

- 红色表示新建文件或者新修改的文件,都在工作区.

- 绿色表示文件在暂存区

  ```bash
  # 查看当前文件状态
  git status
  ```

### **5.将工作区文件添加到暂存区**

```bash
  # 添加项目中所有文件
  # 并不是所有文件都需要提交,所以在添加前设置好需要排除文件
  git add .
  # 添加指定文件
  git add xxxxx.py
```

### **6.将暂存区文件提交到仓库区**

- `commit`会生成一条版本记录

- `-m`后面是版本描述信息

  ```bash
  # 在提交时,必须填写版本描述,表示当前提交代码完成了那些功能
  git commit -m '版本描述'
  # 代码编辑完成后即可进行add和commit操作
  # 提示：添加和提交合并命令
  git commit -am "版本描述"
  ```

### **7.查看历史版本**

`git reflog` 可以查看所有分支的所有操作记录（包括commit和reset的操作），包括已经被删除的commit记录，`git log` 则不能察看已经删除了的commit记录

```bash
  git log
  或者
  git reflog
```

### **8.回退版本**

- **方案一：**

  - `HEAD`表示当前最新版本

  - `HEAD^`表示当前最新版本的前一个版本

  - `HEAD^^`表示当前最新版本的前两个版本，**以此类推...**

  - `HEAD~1`表示当前最新版本的前一个版本

  - `HEAD~10`表示当前最新版本的前10个版本，**以此类推...**

    ```bash
    git reset --hard HEAD^
    ```

- **方案二：当版本非常多时可选择的方案**

- 通过每个版本的版本号回退到指定版本

  ```bash
    git reset --hard 版本号
  ```

### **9.撤销修改**

- 只能撤销工作区、暂存区的代码,不能撤销仓库区的代码

- 撤销仓库区的代码就相当于回退版本操作

  - 撤销工作区代码

    ```bash
    git checkout 文件名
    ```

- 撤销暂存区代码

```bash
# 第一步：将暂存区代码撤销到工作区
git reset HEAD  文件名
# 第二步：撤销工作区代码
git checkout 文件名
```

### **10.删除文件**：删除文件分为确定删除和误删

- 在项目中新建`test.py`文件，并添加和提交到仓库

  - 确定删除处理：

    ```bash
      # 删除文件
      rm 文件名
      # git确定删除文件，对比添加文件git add 
      git rm 文件名
      # 删除后记录删除操作版本
      git commit -m '删除描述'
    ```

- 误删处理：撤销修改即可

```bash
  # 删除文件
  rm 文件名
  # git撤销修改
  git checkout -- 文件名
```

## 2.GIT远程Github操作

### 1.克隆远程仓库代码

``````bash
git clone 'Github远程仓库链接地址'
``````

### 2.推送项目到远程仓库

```bash
  # 工作区添加到暂存区
  git add .
  # 暂存区提交到仓库区
  git commit -m '立项'
  # 推送到远程仓库
  git push
```

在 push 的时候需要设置账号与密码，该密码则是 github 的账号与密码

- 如果在每次 push 都需要设置账号与密码，那么可以设置记住密码

  ```bash
  设置记住密码（默认15分钟）：
  git config --global credential.helper cache
  如果想自己设置时间，可以这样做(1小时后失效)：
  git config credential.helper 'cache --timeout=3600'
  长期存储密码：
  git config --global credential.helper store
  ```

### 3.拉取远程仓库代码

``````bash
# 同步服务器代码
git pull
``````



## 3.代码冲突

**多人协同开发时，避免不了会出现代码冲突的情况,即多人同时修改了同一个文件**

- **现象:**
  - 张三编辑完代码push到仓库后,李四在不知张三编辑过代码后修改完代码也执行了push命令,则会出现代码冲突现象.	

- **解决方法:**
  - 在编辑代码前,先从服务器pull下代码,原则上谁冲突谁解决，并且一定要协商解决,并保留所有代码或者保留某一人代码,解决完冲突代码后，依然需要`add`、`commit`、`push`

- **容易冲突的操作方式**
  - 多个人同时操作了同一个文件
  - 一个人一直写不提交
  - 修改之前不更新最新代码
  - 提交之前不更新最新代码
  - 擅自修改同事代码
- **减少冲突的操作方式**
  - 养成良好的操作习惯,先`pull`在修改,修改完立即`commit`和`push`
  - 一定要确保自己正在修改的文件是最新版本的
  - 各自开发各自的模块
  - 如果要修改公共文件,一定要先确认有没有人正在修改
  - 下班前一定要提交代码,上班第一件事`pull`拉取最新代码
  - 一定不要擅自修改同事的代码

## 4.分支操作

- 作用：
  - 区分生产环境代码以及开发环境代码
  - 研究新的功能或者攻关难题
  - 解决线上bug
- 特点：
  - 项目开发中公用分支包括master、dev
  - 分支master是默认分支，用于发布，当需要发布时将dev分支合并到master分支
  - 分支dev是用于开发的分支，开发完阶段性的代码后，需要合并到master分支

- 1.查看当前分支

  ```bash
    git branch
  ```

  - 没有创建其他分支时，只有`master`分支

- 2.创建并切换到dev分支

  ```bash
   git checkout -b dev
  ```

- 3.设置本地分支跟踪远程指定分支（将分支推送到远程）

  ```bash
    git push -u origin dev
  ```

- 4.dev分支合并到master分支

  - 提示：只有当dev分支合并到master分支成功

  - 4.1 先切换到master分支

    ```bash
      git checkout master
    ```

  - 4.2 dev分支合并到master分支

    ```bash
      git merge dev
    ```

  - 4.3 推送合并分支操作到远程仓库

    - 合并分支默认在本地完成，合并后直接推送即可

      ```bash
      git push
      ```

- 5.只有当同步代码成功，分支合并才算成功

  ```bash
  git pull
  ```

